<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚è∞ Timestamp Converter</title>

    <!-- Load Chrono.js for robust date parsing (browser build) -->
    <script src="https://cdn.jsdelivr.net/npm/chrono-node@1.4.8/dist/chrono.min.js"
        integrity="sha384-QQ9OclfOg8G5XSdbe3NhrfR4OnaJ3CYO63I4yzBPagmDetEQmaVGIoOladQmdC3X"
        crossorigin="anonymous"></script>

    <!-- Load Day.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"
        integrity="sha384-DpVxUeeBWjUvUV1czyIHJAjh+jYUZFu2lLakbdua5vbwOrBGi1UgaKCHjTC+x3Ky"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/utc.js"
        integrity="sha384-TDBg/mCj+oYkZ1ICA3eRE8wZ8pWi5rI4dOiNLzsqr2yD/URay0KLidCnoQbp91uR"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/timezone.js"
        integrity="sha384-LscaYdErRSQej71MTUTT+VCL6X13unRNIDYGKRTUzG9/170GXKRQbXn6U1ZrY08I"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/customParseFormat.js"
        integrity="sha384-3Widcbv7gnkZageHLPaEWrAqIUszz+mV/CIq6SRCv1am0lCnXmbOezw0Whk6Fz54"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/advancedFormat.js"
        integrity="sha384-K60bZCD72oOR/MuW1kPgOQ105VLQ1QyAjK7nTFW1fUra3ev8z7o5I0Vlu3lLuQ6T"
        crossorigin="anonymous"></script>

    <style>
        :root {
            --bg-gradient-start: #667eea;
            --bg-gradient-end: #764ba2;
            --container-bg: #ffffff;
            --text-primary: #333333;
            --text-secondary: #555555;
            --text-tertiary: #888888;
            --input-border: #e0e0e0;
            --input-focus: #667eea;
            --input-bg: #ffffff;
            --input-error-bg: #fff5f5;
            --input-error-border: #ff6b6b;
            --button-bg: #667eea;
            --button-hover: #5568d3;
            --info-bg: #f8f9fa;
            --info-text: #666666;
            --border-color: #e0e0e0;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        body.dark-mode {
            --bg-gradient-start: #1a1a2e;
            --bg-gradient-end: #16213e;
            --container-bg: #0f3460;
            --text-primary: #e4e4e4;
            --text-secondary: #c5c5c5;
            --text-tertiary: #a0a0a0;
            --input-border: #2d4059;
            --input-focus: #667eea;
            --input-bg: #1a2332;
            --input-error-bg: #3d1f1f;
            --input-error-border: #ff6b6b;
            --button-bg: #667eea;
            --button-hover: #5568d3;
            --info-bg: #1a2332;
            --info-text: #a0a0a0;
            --border-color: #2d4059;
            --shadow: rgba(0, 0, 0, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            transition: background 0.3s ease;
        }

        .container {
            background: var(--container-bg);
            border-radius: 16px;
            box-shadow: 0 20px 60px var(--shadow);
            padding: 40px;
            max-width: 600px;
            width: 100%;
            transition: background 0.3s ease, box-shadow 0.3s ease;
            position: relative;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--info-bg);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            background: var(--input-focus);
            border-color: var(--input-focus);
        }

        h1 {
            text-align: center;
            color: var(--text-primary);
            margin-bottom: 30px;
            font-size: 28px;
            transition: color 0.3s ease;
        }

        .converter-section {
            margin-bottom: 25px;
        }

        label {
            display: block;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: color 0.3s ease;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--input-border);
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Courier New', monospace;
            background: var(--input-bg);
            color: var(--text-primary);
            transition: border-color 0.3s, background 0.3s, color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--input-focus);
        }

        input[type="text"].error {
            border-color: var(--input-error-border);
            background-color: var(--input-error-bg);
        }

        .button-group {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

        button {
            flex: 1;
            padding: 10px 20px;
            background: var(--button-bg);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s, transform 0.1s;
        }

        button:hover {
            background: var(--button-hover);
        }

        button:active {
            transform: scale(0.98);
        }

        button.success {
            background: #51cf66;
        }

        .info {
            text-align: center;
            color: var(--text-tertiary);
            font-size: 12px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        .timezone-info {
            background: var(--info-bg);
            padding: 12px;
            border-radius: 6px;
            margin-top: 20px;
            font-size: 13px;
            color: var(--info-text);
            text-align: center;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .format-section {
            background: var(--info-bg);
            padding: 16px;
            border-radius: 8px;
            margin-top: 20px;
            transition: background 0.3s ease;
        }

        .format-section label {
            margin-bottom: 8px;
        }

        .format-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .format-controls input[type="text"] {
            flex: 1;
        }

        .format-controls button {
            flex: 0 0 auto;
            padding: 10px 16px;
        }

        .format-help {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 8px;
            font-family: 'Courier New', monospace;
            transition: color 0.3s ease;
        }

        .format-help a {
            color: var(--input-focus);
            transition: opacity 0.3s ease;
        }

        .format-help a:hover {
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <div class="container">
        <button class="theme-toggle" id="themeToggle" title="Toggle dark mode">üåô</button>
        <h1>‚è∞ Timestamp Converter</h1>

        <div class="converter-section">
            <label for="localTime">Input Time</label>
            <input type="text" id="localTime"
                placeholder="Enter timestamp (e.g., 2025-12-16 08:42:00 PST or 2025-12-16T08:42:00-05:00)">
            <div class="button-group">
                <button id="copyLocal">Copy Input Time</button>
            </div>
        </div>

        <div class="converter-section">
            <label for="utcTime">UTC</label>
            <input type="text" id="utcTime" placeholder="Enter timestamp (e.g., 2025-12-16 08:42:00 UTC)">
            <div class="button-group">
                <button id="copyUtc">Copy UTC</button>
            </div>
        </div>

        <div class="timezone-info">
            Your local timezone: <strong id="localTimezone">Loading...</strong>
        </div>

        <div class="format-section">
            <label for="formatInput">Output Format</label>
            <div class="format-controls">
                <input type="text" id="formatInput" placeholder="YYYY-MM-DD HH:mm:ss z">
                <button id="resetFormat">Reset</button>
            </div>
            <div class="format-help">
                Uses Day.js format tokens: YYYY=year, MM=month, DD=day, HH=hour, mm=minute, ss=second | Use [brackets]
                for literal text<br>
                <a href="https://day.js.org/docs/en/display/format" target="_blank" style="color: #667eea;">View full
                    format documentation ‚Üí</a>
            </div>
        </div>

        <div class="info">
            Paste or type a timestamp in either field to convert automatically
        </div>
    </div>

    <script>
        // Extend dayjs with plugins
        dayjs.extend(window.dayjs_plugin_utc);
        dayjs.extend(window.dayjs_plugin_timezone);
        dayjs.extend(window.dayjs_plugin_customParseFormat);
        dayjs.extend(window.dayjs_plugin_advancedFormat);

        // Get DOM elements
        const localInput = document.getElementById('localTime');
        const utcInput = document.getElementById('utcTime');
        const copyLocalBtn = document.getElementById('copyLocal');
        const copyUtcBtn = document.getElementById('copyUtc');
        const timezoneDisplay = document.getElementById('localTimezone');
        const formatInput = document.getElementById('formatInput');
        const resetFormatBtn = document.getElementById('resetFormat');
        const themeToggleBtn = document.getElementById('themeToggle');

        // Theme management
        const THEME_KEY = 'timeswap-theme';
        const LIGHT_THEME = 'light';
        const DARK_THEME = 'dark';

        // Load theme from localStorage or default to light
        let currentTheme = localStorage.getItem(THEME_KEY) || LIGHT_THEME;

        function applyTheme(theme) {
            if (theme === DARK_THEME) {
                document.body.classList.add('dark-mode');
                themeToggleBtn.textContent = '‚òÄÔ∏è';
                themeToggleBtn.title = 'Toggle light mode';
            } else {
                document.body.classList.remove('dark-mode');
                themeToggleBtn.textContent = 'üåô';
                themeToggleBtn.title = 'Toggle dark mode';
            }
            currentTheme = theme;
            localStorage.setItem(THEME_KEY, theme);
        }

        function toggleTheme() {
            const newTheme = currentTheme === LIGHT_THEME ? DARK_THEME : LIGHT_THEME;
            applyTheme(newTheme);
        }

        // Apply saved theme on load
        applyTheme(currentTheme);

        // Theme toggle button event listener
        themeToggleBtn.addEventListener('click', toggleTheme);

        // Detect local timezone
        const localTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        const timezoneAbbr = dayjs().tz(localTimezone).format('z');
        timezoneDisplay.textContent = `${localTimezone} (${timezoneAbbr})`;

        // Flag to prevent infinite loops during conversion
        let isConverting = false;

        // Default output format
        const DEFAULT_FORMAT = 'YYYY-MM-DD HH:mm:ss z';

        // Load format from localStorage or use default
        let OUTPUT_FORMAT = localStorage.getItem('timestampFormat') || DEFAULT_FORMAT;
        formatInput.value = OUTPUT_FORMAT;

        // Supported input formats for parsing
        const PARSE_FORMATS = [
            'YYYY-MM-DD HH:mm:ss',
            'YYYY-MM-DD HH:mm',
            'YYYY-MM-DDTHH:mm:ss',
            'YYYY-MM-DDTHH:mm:ssZ',
            'YYYY-MM-DD',
            'MM/DD/YYYY HH:mm:ss',
            'MM/DD/YYYY HH:mm',
            'MM/DD/YYYY',
            'DD/MM/YYYY HH:mm:ss',
            'DD/MM/YYYY HH:mm',
            'DD/MM/YYYY'
        ];

        /**
         * Parse a timestamp string robustly
         */
        function parseTimestamp(input) {
            if (!input || input.trim() === '') {
                return null;
            }

            const originalInput = input.trim();
            const numericOffsetPattern = /([+-]\d{2}:?\d{2}|Z)$/i;
            const hasNumericOffset = numericOffsetPattern.test(originalInput);

            // Try parsing as Unix timestamp (seconds or milliseconds)
            if (/^\d+$/.test(originalInput)) {
                const timestamp = parseInt(originalInput, 10);
                const parsedUnix = originalInput.length === 10 ? dayjs.unix(timestamp) : dayjs(timestamp);
                return {
                    date: parsedUnix,
                    hasExplicitTimezone: true
                };
            }

            // Use Chrono.js for robust parsing (handles timezone abbreviations & natural language)
            if (typeof chrono !== 'undefined') {
                const chronoResults = chrono.parse(originalInput);
                if (chronoResults.length > 0) {
                    const chronoDate = chronoResults[0];
                    const chronoDayjs = dayjs(chronoDate.start.date());
                    const chronoHasTimezone = chronoDate.start.isCertain('timezoneOffset');
                    return {
                        date: chronoDayjs,
                        hasExplicitTimezone: chronoHasTimezone
                    };
                }
            }

            // Try ISO format and Day.js default parser
            let parsed = dayjs(originalInput);
            if (parsed.isValid()) {
                return {
                    date: parsed,
                    hasExplicitTimezone: hasNumericOffset
                };
            }

            // Try with custom formats
            for (const format of PARSE_FORMATS) {
                parsed = dayjs(originalInput, format, true);
                if (parsed.isValid()) {
                    return {
                        date: parsed,
                        hasExplicitTimezone: hasNumericOffset
                    };
                }
            }

            return null;
        }

        /**
         * Convert local time to UTC
         */
        function localToUtc(input) {
            if (isConverting) return;
            isConverting = true;

            const parsedResult = parseTimestamp(input);

            if (parsedResult) {
                const { date, hasExplicitTimezone } = parsedResult;

                let utcTime;
                if (hasExplicitTimezone) {
                    utcTime = date.tz('UTC');
                } else {
                    utcTime = date.tz(localTimezone, true).utc().tz('UTC');
                }

                utcInput.value = utcTime.format(OUTPUT_FORMAT);
                utcInput.classList.remove('error');
                localInput.classList.remove('error');
            } else if (input.trim() !== '') {
                utcInput.value = '';
                localInput.classList.add('error');
            } else {
                utcInput.value = '';
                localInput.classList.remove('error');
            }

            isConverting = false;
        }

        /**
         * Convert UTC to local time
         */
        function utcToLocal(input) {
            if (isConverting) return;
            isConverting = true;

            // Remove " UTC" suffix if present
            input = input.replace(/\s+UTC$/i, '').trim();

            const parsedResult = parseTimestamp(input);

            if (parsedResult) {
                const { date } = parsedResult;
                // Interpret as UTC and convert to local time
                const localTime = date.tz('UTC').tz(localTimezone);
                localInput.value = localTime.format(OUTPUT_FORMAT);
                localInput.classList.remove('error');
                utcInput.classList.remove('error');
            } else if (input.trim() !== '') {
                localInput.value = '';
                utcInput.classList.add('error');
            } else {
                localInput.value = '';
                utcInput.classList.remove('error');
            }

            isConverting = false;
        }

        /**
         * Copy text to clipboard
         */
        async function copyToClipboard(text, button) {
            if (!text) return;

            try {
                await navigator.clipboard.writeText(text);
                const originalText = button.textContent;
                button.textContent = '‚úì Copied!';
                button.classList.add('success');

                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('success');
                }, 2000);
            } catch (err) {
                console.error('Failed to copy:', err);
                button.textContent = '‚úó Failed';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
            }
        }

        // Event listeners for conversion
        localInput.addEventListener('input', (e) => {
            localToUtc(e.target.value);
        });

        utcInput.addEventListener('input', (e) => {
            utcToLocal(e.target.value);
        });

        // Auto-select text on mouse enter
        localInput.addEventListener('mouseenter', (e) => {
            e.target.select();
        });

        utcInput.addEventListener('mouseenter', (e) => {
            e.target.select();
        });

        formatInput.addEventListener('mouseenter', (e) => {
            e.target.select();
        });

        // Event listeners for copy buttons
        copyLocalBtn.addEventListener('click', () => {
            copyToClipboard(localInput.value, copyLocalBtn);
        });

        copyUtcBtn.addEventListener('click', () => {
            copyToClipboard(utcInput.value, copyUtcBtn);
        });

        // Event listener for format changes
        formatInput.addEventListener('input', (e) => {
            const newFormat = e.target.value.trim();
            if (newFormat) {
                OUTPUT_FORMAT = newFormat;
                localStorage.setItem('timestampFormat', OUTPUT_FORMAT);

                // Re-convert current values with new format
                if (localInput.value) {
                    localToUtc(localInput.value);
                }
            }
        });

        // Event listener for reset format button
        resetFormatBtn.addEventListener('click', () => {
            OUTPUT_FORMAT = DEFAULT_FORMAT;
            formatInput.value = DEFAULT_FORMAT;
            localStorage.setItem('timestampFormat', DEFAULT_FORMAT);

            // Re-convert current values with default format
            if (localInput.value) {
                localToUtc(localInput.value);
            }
        });

        // Initialize with current time
        window.addEventListener('load', () => {
            const now = dayjs();
            localInput.value = now.format(OUTPUT_FORMAT);
            localToUtc(localInput.value);
        });
    </script>
</body>

</html>